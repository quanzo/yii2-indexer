indexer модуль для Yii 2
========================

Модуль предназначен для сохранения формируемого контента в БД для дальнейщего
поиска.

Страницы, полученные через POST, будут игнорироваться.

Обязательно задать, через параметр *exclude*, адреса которые не должны попасть в
базу.

Используется полнотекстовый поиск Mysql

При сохранении, url формируется как `путь/к/action?параметры`, например
`site/default/index?param=1`

Установка и подключение
-----------------------

1.  Скопировать в папку с модулями

2.  Установить структуру таблиц из миграции

3.  Подключить *autoload.php*

4.  Подключить в *сonfig.php*

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
$config = [
    'bootstrap' => [
        'indexer',
    ],
    'modules' => [
        'indexer' => [
            'class' => 'x51\yii2\modules\indexer\Module',
            // 'fullpageMode' => false, // сохранять всю страницу или только контент (без layout)
            // 'ttl' => 86400, // время жизни содержимого в БД, в сек.
            // 'exclude' => [], // роуты в которых запрещено использование. Можно применять символы ? и *
            // 'layoutRule' => '*/layouts/*', // маска для определения layout
            // 'saveOrigContent' => true, // сохранять в БД html
            // 'saveOrigTitle' => true, // сохранять в БД оригинал заголовока страницы
            // 'defaultPageSize' => 15, // размер страницы поиска по умолчанию
            //'on'.\x51\yii2\modules\indexer\Module::EVENT_BEFORE_INDEX => function ($event) {}, // событие перед сохранением страницы в БД
        ],
    ], // end modules
];
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

Использование
-------------

Адрес страницы поиска: *http://site.domain/index.php?r=indexer*

События
-------

Событие `\x51\yii2\modules\indexer\Module::EVENT_BEFORE_INDEX` вызывается перед
сохранением результата в БД.

В обработчик передается объект типа
`x51\yii2\modules\indexer\events\BeforeIndexEvent`

Если в объекте задать параметр `isValid=false`, то сохранение данных не
произойдет.

Также в объекте события доступны параметры:

-   *module* - ссылка на объект модуля

-   *model* - модель, подготовленная к сохранению. Эта модель и будет сохранена.
    Можно изменить данные перед сохранением.

Методы модуля
-------------

-   `function search($text, $perpage = false, $page = 1, &$count = false)`

Выполняет поиск.

Если задать `$perpage`, то будет постарничный вывод.

В `$count` возвращается общее колтчество найденных записей.

-   `function actualUrl($url)`

Формирует из url, сохраненного в БД, актуальный url.

-   `public function getIndexContent($url)`

По url возвращает сохраненную запись

 

 

 

 
